# üçî Food Core API

<div align="center">

[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=soat-fiap_food-core-api&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=soat-fiap_food-core-api)
[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=soat-fiap_food-core-api&metric=reliability_rating)](https://sonarcloud.io/summary/new_code?id=soat-fiap_food-core-api)
[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=soat-fiap_food-core-api&metric=security_rating)](https://sonarcloud.io/summary/new_code?id=soat-fiap_food-core-api)
[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=soat-fiap_food-core-api&metric=coverage)](https://sonarcloud.io/summary/new_code?id=soat-fiap_food-core-api)
[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=soat-fiap_food-core-api&metric=sqale_rating)](https://sonarcloud.io/summary/new_code?id=soat-fiap_food-core-api)
[![Tests](https://github.com/soat-fiap/food-core-api/actions/workflows/tests.yml/badge.svg)](https://github.com/soat-fiap/food-core-api/actions/workflows/tests.yml)
[![Build](https://github.com/soat-fiap/food-core-api/actions/workflows/build.yml/badge.svg)](https://github.com/soat-fiap/food-core-api/actions/workflows/build.yml)

</div>

API de gerenciamento de pedidos para restaurantes fast-food, desenvolvida como parte do curso de Arquitetura de Software da FIAP (Tech Challenge).

<div align="center">
  <a href="#visao-geral">Vis√£o Geral</a> ‚Ä¢
  <a href="#arquitetura">Arquitetura</a> ‚Ä¢
  <a href="#tecnologias">Tecnologias</a> ‚Ä¢
  <a href="#diagramas">Diagramas</a> ‚Ä¢
  <a href="#instalacao-e-uso">Instala√ß√£o e Uso</a> ‚Ä¢
  <a href="#estrutura-do-projeto">Estrutura do Projeto</a> ‚Ä¢ <br/>
  <a href="#apis">APIs</a> ‚Ä¢
  <a href="#banco-de-dados">Banco de Dados</a> ‚Ä¢
  <a href="#resolucao-de-problemas">Resolu√ß√£o de Problemas</a> ‚Ä¢
  <a href="#contribuicao-e-licenca">Contribui√ß√£o e Licen√ßa</a>
</div>

<h2 id="visao-geral">üìã Vis√£o Geral</h2>

O sistema implementa um servi√ßo de auto-atendimento para uma lanchonete de fast-food, permitindo que os clientes fa√ßam pedidos e acompanhem o status do seu pedido sem a necessidade de intera√ß√£o com um atendente. A aplica√ß√£o tamb√©m inclui um painel administrativo para gerenciamento de produtos, clientes e acompanhamento de pedidos.

### Principais recursos

- **Auto-atendimento**: Interface para clientes realizarem pedidos
- **Identifica√ß√£o de cliente**: Por CPF ou cadastro com nome e e-mail
- **Pagamento integrado**: Via QRCode do Mercado Pago
- **Acompanhamento de pedido**: Status em tempo real (Recebido, Em prepara√ß√£o, Pronto, Finalizado)
- **Painel administrativo**: Gerenciamento de produtos, categorias e pedidos

<h2 id="arquitetura">üèóÔ∏è Arquitetura</h2>

<details>
<summary>Expandir para mais detalhes</summary>

O projeto segue uma arquitetura modular baseada em **Domain-Driven Design (DDD)** com **Spring Modulith** e **Arquitetura Hexagonal**, facilitando a manuten√ß√£o e promovendo desacoplamento.

### Arquitetura Hexagonal (Ports & Adapters)

```mermaid
graph TD
    subgraph "Arquitetura Hexagonal"
        DOMAIN[Dom√≠nio]
        
        subgraph "Portas de Entrada"
            API_Port["API (Porta)"]
            Webhook_Port["Webhook (Porta)"]
            Event_Port["Eventos (Porta)"]
        end
        
        subgraph "Portas de Sa√≠da"
            DB_Port["Banco de Dados (Porta)"]
            MercadoPago_Port["Mercado Pago (Porta)"]
            EventBus_Port["Eventos (Porta)"]
        end
        
        DOMAIN --- API_Port
        DOMAIN --- Webhook_Port
        DOMAIN --- Event_Port
        DOMAIN --- DB_Port
        DOMAIN --- MercadoPago_Port
        DOMAIN --- EventBus_Port
        
        API_Port --- API_Adapter["/api REST Controller"]
        Webhook_Port --- Webhook_Adapter["Webhook Controller"]
        Event_Port --- Event_Adapter["Event Listener"]
        
        DB_Port --- DB_Adapter["JPA Repository"]
        MercadoPago_Port --- MercadoPago_Adapter["MercadoPago Client"]
        EventBus_Port --- EventBus_Adapter["ApplicationEventPublisher"]
    end
```

### Monolito Modular (Spring Modulith)

A aplica√ß√£o √© estruturada como um monolito modular usando Spring Modulith, com contextos limitados (bounded contexts) bem definidos para cada dom√≠nio de neg√≥cio:

```mermaid
graph TD
    subgraph "Monolito Modular"
        ORDER[M√≥dulo Pedido]
        CUSTOMER[M√≥dulo Cliente]
        PRODUCT[M√≥dulo Produto]
        PAYMENT[M√≥dulo Pagamento]
        SHARED[Componentes Compartilhados]
        
        ORDER --> CUSTOMER
        ORDER --> PRODUCT
        ORDER --> PAYMENT
        PAYMENT --> ORDER
        
        SHARED --> ORDER
        SHARED --> CUSTOMER
        SHARED --> PRODUCT
        SHARED --> PAYMENT
    end
```

Cada m√≥dulo:

- √â autocontido, com seus pr√≥prios adaptadores, portas e dom√≠nio
- Comunica-se com outros m√≥dulos atrav√©s de eventos de dom√≠nio
- Pode ser extra√≠do como um servi√ßo independente no futuro

### Eventos de Dom√≠nio

O sistema utiliza eventos de dom√≠nio ass√≠ncronos entre m√≥dulos, permitindo:

- Comunica√ß√£o desacoplada
- Notifica√ß√µes entre contextos limitados
- F√°cil migra√ß√£o para uma arquitetura distribu√≠da no futuro

</details>

<h2 id="tecnologias">üîß Tecnologias</h2>

<details>
<summary>Expandir para mais detalhes</summary>

### Backend

- **Java 21**: Linguagem principal
- **Spring Boot 3.4**: Framework base
- **Spring Modulith**: Para organiza√ß√£o modular da aplica√ß√£o
- **Spring Data JPA**: Persist√™ncia e acesso a dados
- **Spring Security**: Seguran√ßa e autentica√ß√£o
- **MapStruct**: Mapeamento entre DTOs e entidades
- **Lombok**: Redu√ß√£o de c√≥digo boilerplate

### Banco de Dados & Cache

- **PostgreSQL**: Banco de dados relacional principal
- **Redis**: Cache distribu√≠do
- **Liquibase**: Migra√ß√µes de banco de dados

### Infraestrutura & Observabilidade

- **Docker**: Containeriza√ß√£o
- **Gradle**: Gerenciamento de depend√™ncias e builds
- **SonarQube/SonarCloud**: An√°lise est√°tica de c√≥digo
- **GitHub Actions**: CI/CD
- **Swagger/OpenAPI**: Documenta√ß√£o de API

### Integra√ß√£o

- **Mercado Pago API**: Processamento de pagamentos

</details>

<h2 id="diagramas">üìä Diagramas</h2>

<details>
<summary>Expandir para mais detalhes</summary>

### Modelo de Dom√≠nio

```mermaid
classDiagram
    class Order {
        -Long id
        -String orderNumber
        -OrderStatus status
        -Customer customer
        -BigDecimal totalAmount
        -List~OrderItem~ items
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        +addItem(OrderItem)
        +removeItem(OrderItem)
        +calculateTotalAmount()
        +updateStatus(OrderStatus)
    }
    
    class OrderItem {
        -Long id
        -Product product
        -Integer quantity
        -BigDecimal unitPrice
        -BigDecimal subtotal
        -String observations
        +calculateSubtotal()
    }
    
    class Product {
        -Long id
        -String name
        -String description
        -Category category
        -BigDecimal price
        -String imageUrl
        -boolean active
    }
    
    class Category {
        <<enumeration>>
        BURGER
        SIDE
        BEVERAGE
        DESSERT
    }
    
    class Customer {
        -Long id
        -String name
        -String document
        -String email
        -String phone
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        -boolean active
    }
    
    class OrderStatus {
        <<enumeration>>
        PENDING
        PREPARING
        READY
        COMPLETED
        CANCELLED
    }
    
    Order "1" *-- "many" OrderItem
    Order "many" -- "1" Customer
    OrderItem "many" -- "1" Product
    Product -- Category
    Order -- OrderStatus
```

### DER (Diagrama Entidade-Relacionamento)

```mermaid
erDiagram
    CUSTOMERS ||--o{ ORDERS : places
    PRODUCTS ||--o{ ORDER_ITEMS : included_in
    ORDERS ||--o{ ORDER_ITEMS : contains
    ORDERS ||--o| PAYMENTS : has
    
    CUSTOMERS {
        id BIGINT PK
        name VARCHAR(100)
        email VARCHAR(100)
        document VARCHAR(20)
        phone VARCHAR(20)
        created_at TIMESTAMP
        updated_at TIMESTAMP
        active BOOLEAN
    }
    
    PRODUCTS {
        id BIGINT PK
        name VARCHAR(100)
        description TEXT
        category VARCHAR(20)
        price DECIMAL(10_2)
        image_url VARCHAR(255)
        created_at TIMESTAMP
        updated_at TIMESTAMP
        active BOOLEAN
    }
    
    ORDERS {
        id BIGINT PK
        order_number VARCHAR(20)
        customer_id BIGINT FK
        status VARCHAR(20)
        total DECIMAL(10_2)
        created_at TIMESTAMP
        updated_at TIMESTAMP
    }
    
    ORDER_ITEMS {
        id BIGINT PK
        order_id BIGINT FK
        product_id BIGINT FK
        product_name VARCHAR(100)
        quantity INTEGER
        unit_price DECIMAL(10_2)
        total DECIMAL(10_2)
        observations TEXT
    }
    
    PAYMENTS {
        id BIGINT PK
        order_id BIGINT FK
        external_id VARCHAR(100)
        amount DECIMAL(10_2)
        status VARCHAR(20)
        payment_method VARCHAR(50)
        qr_code_url VARCHAR(255)
        qr_code_data TEXT
        created_at TIMESTAMP
        processed_at TIMESTAMP
    }
```

### Fluxo de Realiza√ß√£o do Pedido e Pagamento (Event Storming)

```mermaid
flowchart TD
    %% Eventos de Dom√≠nio
    E1[CustomerIdentified] --> E2[OrderCreated]
    E2 --> E3[ItemAdded]
    E3 --> E4[OrderConfirmed]
    E4 --> E5[PaymentRequested]
    E5 --> E6[QRCodeGenerated]
    E6 --> E7[PaymentReceived]
    E7 --> E8[OrderReceived]
    
    %% Comandos
    C1[IdentifyCustomer] --> E1
    C2[CreateOrder] --> E2
    C3[AddItem] --> E3
    C4[ConfirmOrder] --> E4
    C5[RequestPayment] --> E5
    C6[GenerateQRCode] --> E6
    C7[ConfirmPayment] --> E7
    C8[ReceiveOrder] --> E8
    
    %% Atores
    A1[Customer] --> C1
    A1 --> C2
    A1 --> C3
    A1 --> C4
    A1 --> C5
    A2[PaymentSystem] --> C7
    A3[Attendant] --> C8
```

### Fluxo de Prepara√ß√£o e Entrega do Pedido (Event Storming)

```mermaid
flowchart TD
    %% Eventos de Dom√≠nio
    E1[OrderReceived] --> E2[PreparationStarted]
    E2 --> E3[OrderReady]
    E3 --> E4[CustomerNotified]
    E4 --> E5[OrderDelivered]
    E5 --> E6[OrderFinished]
    
    %% Comandos
    C1[StartPreparation] --> E2
    C2[MarkAsReady] --> E3
    C3[NotifyCustomer] --> E4
    C4[DeliverOrder] --> E5
    C5[FinishOrder] --> E6
    
    %% Atores
    A1[Cook] --> C1
    A1 --> C2
    A2[System] --> C3
    A3[Attendant] --> C4
    A3 --> C5
```

</details>

<h2 id="instalacao-e-uso">üöÄ Instala√ß√£o e Uso</h2>

<details>
<summary>Expandir para mais detalhes</summary>

### Requisitos

- Docker e Docker Compose
- JDK 21+
- Gradle 8.0+

### Script Centralizador `food`

O projeto utiliza um script centralizador `food` para gerenciar todas as opera√ß√µes:

```bash
./food [comando] [op√ß√µes]
```

#### Comandos Principais

| Comando | Descri√ß√£o |
|---------|-----------|
| `start:all` | Inicia toda a infraestrutura e a aplica√ß√£o |
| `start:infra` | Inicia apenas a infraestrutura (banco, redis, cdn) |
| `start:app` | Inicia apenas a aplica√ß√£o |
| `stop:all` | Para todos os servi√ßos |
| `stop:infra` | Para apenas a infraestrutura |
| `stop:app` | Para apenas a aplica√ß√£o |
| `restart:all` | Reinicia todos os servi√ßos |
| `restart:app` | Reinicia apenas a aplica√ß√£o |
| `db:up` | Aplica migra√ß√µes do banco de dados |
| `db:reset` | Reseta o banco de dados |
| `logs` | Exibe logs dos containers |
| `logs:app` | Exibe logs apenas da aplica√ß√£o |
| `logs:db` | Exibe logs apenas do banco de dados |
| `status` | Exibe status dos containers |
| `clean` | Remove containers, imagens e volumes n√£o utilizados |
| `help` | Exibe a mensagem de ajuda |

#### Op√ß√µes

- `--build`, `-b`: Reconstr√≥i as imagens antes de iniciar
- `--force`, `-f`: For√ßa a execu√ß√£o sem confirma√ß√£o

### Iniciando o Ambiente do Zero

```bash
# Clone o reposit√≥rio
git clone https://github.com/soat-fiap/food-core-api.git
cd food-core-api

# Tornar o script principal execut√°vel
chmod +x food

# Iniciar infraestrutura (banco, redis, cdn, adminer)
./food start:infra

# Resetar e configurar o banco de dados
./food db:reset

# Iniciar a aplica√ß√£o
./food start:app --build

# Ou iniciar tudo de uma vez
./food start:all --build
```

### Acessando a Aplica√ß√£o

- **API**: <http://localhost:8083/api>
- **Swagger/OpenAPI**: <http://localhost:8083/swagger-ui.html>
- **Adminer (gerenciador de banco de dados)**: <http://localhost:8081>
  - Sistema: PostgreSQL
  - Servidor: db
  - Usu√°rio: postgres
  - Senha: postgres
  - Banco: fastfood
- **CDN**: <http://localhost:8082>

### Ambientes e Dados de Seed

O projeto suporta diferentes ambientes com diferentes conjuntos de dados:

- **Produ√ß√£o (perfil: prod)**: Apenas dados essenciais
- **Desenvolvimento (perfil: dev/local)**: Dados essenciais + dados adicionais para testes

Para executar a aplica√ß√£o em modo de desenvolvimento:

```bash
# Usando vari√°vel de ambiente SPRING_PROFILES_ACTIVE
SPRING_PROFILES_ACTIVE=dev ./gradlew bootRun

# Ou usando par√¢metro na linha de comando
./gradlew bootRun --args='--spring.profiles.active=local'
```

</details>

<h2 id="estrutura-do-projeto">üìÅ Estrutura do Projeto</h2>

<details>
<summary>Expandir para mais detalhes</summary>

O projeto segue uma estrutura modular organizada por dom√≠nios:

```
food-core-api/
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/soat/fiap/food/core/api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FoodCoreApiApplication.java     # Aplica√ß√£o principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order/                          # M√≥dulo Pedido
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application/                # Portas e servi√ßos de aplica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/                     # Modelos de dom√≠nio e regras de neg√≥cio
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mapper/                     # Mappers entre dom√≠nio e DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/             # Implementa√ß√µes de adaptadores
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customer/                       # M√≥dulo Cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product/                        # M√≥dulo Produto 
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment/                        # M√≥dulo Pagamento
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/                         # Componentes compartilhados
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml                 # Configura√ß√µes gerais
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-dev.yml             # Configura√ß√µes de desenvolvimento
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-prod.yml            # Configura√ß√µes de produ√ß√£o
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ db/changelog/                   # Migra√ß√µes Liquibase
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ test/                                   # Testes
‚îÇ
‚îú‚îÄ‚îÄ docker/                                     # Arquivos Docker
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îî‚îÄ‚îÄ services/                               # Servi√ßos adicionais
‚îÇ
‚îú‚îÄ‚îÄ scripts/                                    # Scripts de gerenciamento
‚îÇ
‚îú‚îÄ‚îÄ docs/                                       # Documenta√ß√£o
‚îÇ
‚îú‚îÄ‚îÄ food                                        # Script centralizador
‚îî‚îÄ‚îÄ README.md                                   # Este arquivo
```

### Organiza√ß√£o Modular (DDD / Arquitetura Hexagonal)

Cada m√≥dulo segue a mesma estrutura, implementando a arquitetura hexagonal:

```
m√≥dulo/
‚îú‚îÄ‚îÄ application/                          # Camada de aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ ports/                            # Portas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ in/                           # Portas de entrada
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModuloUseCase.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ out/                          # Portas de sa√≠da
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ModuloRepository.java
‚îÇ   ‚îî‚îÄ‚îÄ services/                         # Servi√ßos de aplica√ß√£o
‚îÇ       ‚îî‚îÄ‚îÄ ModuloService.java
‚îú‚îÄ‚îÄ domain/                               # Dom√≠nio
‚îÇ   ‚îú‚îÄ‚îÄ model/                            # Entidades e objetos de valor
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Entidade.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ObjetoValor.java
‚îÇ   ‚îú‚îÄ‚îÄ events/                           # Eventos de dom√≠nio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EntidadeCreatedEvent.java
‚îÇ   ‚îî‚îÄ‚îÄ exception/                        # Exce√ß√µes de dom√≠nio
‚îú‚îÄ‚îÄ mapper/                               # Mappers entre dom√≠nio e DTOs
‚îÇ   ‚îî‚îÄ‚îÄ ModuloDtoMapper.java
‚îî‚îÄ‚îÄ infrastructure/                       # Infraestrutura
    ‚îú‚îÄ‚îÄ adapters/                         # Adaptadores
    ‚îÇ   ‚îú‚îÄ‚îÄ in/                           # Adaptadores de entrada
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/               # Controllers REST
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModuloController.java
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/                      # DTOs para comunica√ß√£o externa
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ request/              # DTOs de requisi√ß√£o
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ response/             # DTOs de resposta
    ‚îÇ   ‚îî‚îÄ‚îÄ out/                          # Adaptadores de sa√≠da
    ‚îÇ       ‚îú‚îÄ‚îÄ persistence/              # Persist√™ncia de dados
    ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ entity/               # Entidades JPA
    ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ mapper/               # Mappers entre entidades e dom√≠nio
    ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ repository/           # Reposit√≥rios Spring Data
    ‚îÇ       ‚îî‚îÄ‚îÄ integration/              # Integra√ß√µes com servi√ßos externos
    ‚îî‚îÄ‚îÄ config/                           # Configura√ß√µes espec√≠ficas do m√≥dulo
```

</details>

<h2 id="apis">üåê APIs</h2>

<details>
<summary>Expandir para mais detalhes</summary>

O sistema exp√µe duas interfaces principais de API:

1. **API de Auto-Atendimento**: Para clientes se identificarem, visualizarem produtos e fazerem pedidos
2. **API de Gest√£o**: Para administradores gerenciarem produtos, categorias e pedidos

### Endpoints Principais

#### Clientes

```
POST /api/customers                     # Cadastrar cliente
GET /api/customers/{document}           # Obter cliente por documento
GET /api/customers                      # Listar clientes
```

#### Produtos

```
GET /api/products                       # Listar produtos
GET /api/products?category={category}   # Listar produtos por categoria
GET /api/products/{id}                  # Obter produto por ID
```

#### Pedidos

```
POST /api/orders                        # Criar pedido
GET /api/orders                         # Listar pedidos
GET /api/orders?status={status}         # Listar pedidos por status
GET /api/orders/{id}                    # Obter pedido por ID
PATCH /api/orders/{id}/status           # Atualizar status do pedido
POST /api/orders/{id}/items             # Adicionar item ao pedido
```

#### Pagamentos

```
POST /api/orders/{orderId}/payments     # Processar pagamento
GET /api/orders/{orderId}/payments      # Obter informa√ß√µes de pagamento
```

Para documenta√ß√£o completa e interativa, consulte o Swagger/OpenAPI dispon√≠vel em:
<http://localhost:8083/swagger-ui.html>

</details>

<h2 id="banco-de-dados">üíæ Banco de Dados</h2>

<details>
<summary>Expandir para mais detalhes</summary>

### Modelo Relacional

O sistema utiliza PostgreSQL como banco de dados principal, com o seguinte esquema:

```mermaid
erDiagram
    CUSTOMERS ||--o{ ORDERS : places
    PRODUCTS ||--o{ ORDER_ITEMS : included_in
    ORDERS ||--o{ ORDER_ITEMS : contains
    ORDERS ||--o| PAYMENTS : has
    
    CUSTOMERS {
        id BIGINT PK
        name VARCHAR(100)
        email VARCHAR(100)
        document VARCHAR(20)
        phone VARCHAR(20)
        created_at TIMESTAMP
        updated_at TIMESTAMP
        active BOOLEAN
    }
    
    PRODUCTS {
        id BIGINT PK
        name VARCHAR(100)
        description TEXT
        category VARCHAR(20)
        price DECIMAL(10_2)
        image_url VARCHAR(255)
        created_at TIMESTAMP
        updated_at TIMESTAMP
        active BOOLEAN
    }
    
    ORDERS {
        id BIGINT PK
        order_number VARCHAR(20)
        customer_id BIGINT FK
        status VARCHAR(20)
        total DECIMAL(10_2)
        created_at TIMESTAMP
        updated_at TIMESTAMP
    }
    
    ORDER_ITEMS {
        id BIGINT PK
        order_id BIGINT FK
        product_id BIGINT FK
        product_name VARCHAR(100)
        quantity INTEGER
        unit_price DECIMAL(10_2)
        total DECIMAL(10_2)
        observations TEXT
    }
    
    PAYMENTS {
        id BIGINT PK
        order_id BIGINT FK
        external_id VARCHAR(100)
        amount DECIMAL(10_2)
        status VARCHAR(20)
        payment_method VARCHAR(50)
        qr_code_url VARCHAR(255)
        qr_code_data TEXT
        created_at TIMESTAMP
        processed_at TIMESTAMP
    }
```

### Gerenciamento de Migra√ß√µes

O projeto utiliza Liquibase para gerenciar migra√ß√µes de banco de dados, organizadas por m√≥dulo:

```
src/main/resources/db/changelog/
‚îú‚îÄ‚îÄ db.changelog-master.yaml          # Arquivo principal
‚îú‚îÄ‚îÄ modules/                          # Migrations separadas por m√≥dulo
‚îÇ   ‚îú‚îÄ‚îÄ order/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-order-tables.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-order-indexes.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 03-order-seed.sql
‚îÇ   ‚îú‚îÄ‚îÄ customer/
‚îÇ   ‚îú‚îÄ‚îÄ product/
‚îÇ   ‚îî‚îÄ‚îÄ payment/
‚îî‚îÄ‚îÄ shared/
    ‚îî‚îÄ‚îÄ 00-init-schema.sql
```

As migra√ß√µes s√£o aplicadas automaticamente durante a inicializa√ß√£o da aplica√ß√£o, mas tamb√©m podem ser executadas manualmente:

```bash
./food db:up     # Aplicar migra√ß√µes
./food db:reset  # Resetar e recriar o banco de dados
```

### Acesso ao Banco de Dados

Para acessar o banco de dados durante o desenvolvimento, utilize o Adminer dispon√≠vel em:
<http://localhost:8081>

Credenciais:

- Sistema: PostgreSQL
- Servidor: db
- Usu√°rio: postgres
- Senha: postgres
- Banco: fastfood

</details>

<h2 id="resolucao-de-problemas">üîç Resolu√ß√£o de Problemas</h2>

<details>
<summary>Expandir para mais detalhes</summary>

### Problemas com o Banco de Dados

Se voc√™ encontrar erros ao tentar resetar o banco de dados, como:

```
ERROR: database "fastfood" is being accessed by other users
DETAIL: There are X other sessions using the database.
```

Tente estes passos:

```bash
# 1. Parar todos os servi√ßos
./food stop:all

# 2. Limpar recursos Docker n√£o utilizados
./food clean --force

# 3. Iniciar apenas a infraestrutura
./food start:infra

# 4. Tentar o reset novamente
./food db:reset --force
```

### Erros do Liquibase

Se voc√™ encontrar erros de valida√ß√£o do Liquibase como:

```
Validation Failed:
     changesets check sum
     changesets had duplicate identifiers
```

Existem duas abordagens:

1. **Limpar completamente o banco de dados:**

```bash
# Parar todos os servi√ßos
./food stop:all

# Limpar recursos
./food clean --force

# Iniciar tudo novamente
./food start:all --build
```

2. **Atualizar a tabela DATABASECHANGELOG (para desenvolvedores):**

```sql
-- Conecte-se ao banco via Adminer e execute:
DELETE FROM DATABASECHANGELOG 
WHERE filename = 'db/changelog/modules/product/03-product-seed.sql';

-- Aplique as migra√ß√µes novamente
./food db:up
```

### Problemas com o Docker

Se o Docker travar ou apresentar problemas:

```bash
# Reinicie o Docker Desktop
# Em seguida, reinicie a infraestrutura
./food restart:all --build
```

### Porta em Uso

Se alguma porta estiver em uso (como 8080, 8081, 8082, 8083, 5432, 6379):

1. Identifique o processo usando a porta:

   ```bash
   lsof -i :<n√∫mero-da-porta>
   ```

2. Encerre o processo ou altere a porta no arquivo `docker/docker-compose.yml`

</details>

<h2 id="contribuicao-e-licenca">üôè Contribui√ß√£o e Licen√ßa</h2>

### Guia de Contribui√ß√£o

Para contribuir com o projeto, siga estas etapas:

#### Branches

- A branch principal de desenvolvimento √© a `main`
- Para novas funcionalidades, crie uma branch a partir da `main` seguindo o padr√£o:
  - `feature/nome-da-funcionalidade`
- Para corre√ß√µes de bugs, use o padr√£o:
  - `fix/descricao-do-bug`
- Para documenta√ß√£o:
  - `docs/descricao-da-documentacao`
- Para melhorias de performance ou refatora√ß√£o:
  - `refactor/descricao-da-mudanca`

#### Commits

Siga a conven√ß√£o [Conventional Commits](https://www.conventionalcommits.org/):

```
<tipo>[escopo opcional]: <descri√ß√£o>

[corpo opcional]

[rodap√©(s) opcional(is)]
```

Exemplos:

- `feat(order): adiciona endpoint para cancelamento de pedido`
- `fix(customer): corrige valida√ß√£o de CPF`
- `docs: atualiza README com novas instru√ß√µes`
- `refactor(product): melhora desempenho na listagem de produtos`

#### Pull Requests

1. Certifique-se que sua branch est√° atualizada com a `main`
2. Fa√ßa um pull request para a branch `main`
3. Descreva as altera√ß√µes realizadas de forma clara
4. Vincule issues relacionadas
5. Aguarde a revis√£o dos mantenedores

---

### Contribuidores

Este projeto √© mantido por:

- [Caio Souza](https://github.com/caiuzu)
- [Guilherme Cesar](https://github.com/QuatroQuatros)
- [Marcelo Maga](https://github.com/marcelo-maga)
- [Pedro Ferrarezzo](https://github.com/pedroferrarezzo)

---

### Licen√ßa

Este projeto est√° licenciado sob a licen√ßa MIT.
